package com.blackducksoftware.integration.jira.hub.vulnerability;

import java.util.List;

import org.apache.log4j.Logger;

import com.blackducksoftware.integration.hub.exception.UnexpectedHubResponseException;
import com.blackducksoftware.integration.jira.HubJiraLogger;
import com.blackducksoftware.integration.jira.config.HubProjectMappings;
import com.blackducksoftware.integration.jira.config.JiraProject;
import com.blackducksoftware.integration.jira.hub.FilteredNotificationResults;
import com.blackducksoftware.integration.jira.hub.HubNotificationService;
import com.blackducksoftware.integration.jira.hub.HubNotificationServiceException;
import com.blackducksoftware.integration.jira.hub.TicketGeneratorInfo;
import com.blackducksoftware.integration.jira.hub.model.notification.VulnerabilityNotificationContent;

public class VulnerabilityNotificationFilter {
	private final HubJiraLogger logger = new HubJiraLogger(Logger.getLogger(this.getClass().getName()));
	public static final String PROJECT_LINK = "project";
	private final HubProjectMappings mappings;
	private final TicketGeneratorInfo ticketGenInfo;
	private final List<String> linksOfRulesToMonitor;
	private final HubNotificationService hubNotificationService;


	public VulnerabilityNotificationFilter(final HubProjectMappings mappings,
			final TicketGeneratorInfo ticketGenInfo, final List<String> linksOfRulesToMonitor,
			final HubNotificationService hubNotificationService) {
		this.mappings = mappings;
		this.ticketGenInfo = ticketGenInfo;
		this.linksOfRulesToMonitor = linksOfRulesToMonitor;
		this.hubNotificationService = hubNotificationService;
	}

	public FilteredNotificationResults handleNotification(final String projectName, final String projectVersionName,
			final String projectVersionLink, final String componentName, final String componentVersion,
			final VulnerabilityNotificationContent vulnerabilityNotificationContent)
					throws UnexpectedHubResponseException, HubNotificationServiceException {
		final FilteredNotificationResults notifResults = new FilteredNotificationResults();

		final String hubProjectUrl = hubNotificationService.getProjectUrlFromProjectVersionUrl(projectVersionLink);

		final JiraProject jiraProject = mappings.getJiraProject(hubProjectUrl);

		logger.debug("JIRA Project: " + jiraProject);


		return notifResults;
	}
}
